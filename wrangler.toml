name = "cloudflare_redirect"
main = "src/index.ts"
compatibility_date = "2025-10-24"
compatibility_flags = ["nodejs_compat"]

# (Optional) Khai báo KV toàn cục để IDE nhận diện binding
# Lưu ý: Chỉ là placeholder, Wrangler sẽ ưu tiên env cụ thể bên dưới
[[kv_namespaces]]
binding = "REDIRECT_KV"
id = "23717fb69ec34910b4d0942167001260"
preview_id = "9097b5ddc08d4448b45fc416f107cb88"

# Note: ANALYTICS_KV removed - retry queue deferred to Epic 9
# Current analytics implementation is fire-and-forget without persistence

# =====================
# DEV ENVIRONMENT
# =====================
[env.dev]
name = "cloudflare_redirect_dev"

[env.dev.vars]
DEFAULT_REDIRECT_URL = "https://dev.example.com"
GA4_MEASUREMENT_ID = "G-DEVXXXXXXXXX"
ENVIRONMENT = "dev"
ENABLE_TRACKING = "true"
ANALYTICS_PROVIDERS = "ga4"
ALLOWED_DOMAINS = "finejapanvietnam.com,example.com,test.com,localhost"
ANALYTICS_TIMEOUT_MS= 200

[[env.dev.kv_namespaces]]
binding = "REDIRECT_KV"
id = "23717fb69ec34910b4d0942167001260"
preview_id = "9097b5ddc08d4448b45fc416f107cb88"

# =====================
# STAGING ENVIRONMENT
# =====================
[env.staging]
name = "cloudflare_redirect_staging"

[env.staging.vars]
DEFAULT_REDIRECT_URL = "https://staging.example.com"
GA4_MEASUREMENT_ID = "G-STAGINGXXXXXXX"
ENVIRONMENT = "staging"
ENABLE_TRACKING = "true"
ANALYTICS_PROVIDERS = "ga4"
ALLOWED_DOMAINS = "example.com,test.com"
ANALYTICS_TIMEOUT_MS= 200

[[env.staging.kv_namespaces]]
binding = "REDIRECT_KV"
id = "23717fb69ec34910b4d0942167001260"
preview_id = "9097b5ddc08d4448b45fc416f107cb88"

# =====================
# PRODUCTION ENVIRONMENT
# =====================
[env.production]
name = "cloudflare_redirect_production"

[env.production.vars]
DEFAULT_REDIRECT_URL = "https://example.com"
#GA4_MEASUREMENT_ID = "G-PRODXXXXXXXXX"
#GA4_API_SECRET = ""
ENVIRONMENT = "production"
ENABLE_TRACKING = "true"
ANALYTICS_PROVIDERS = "ga4"
ALLOWED_DOMAINS = "finejapanvietnam.com,finejapan.vn,fjp.vn,fwg.vn,fgcare.vn,fgorg.vn,jpc.vn,jpcshop.vn,sencare.vn,example.com,test.com,localhost"
ANALYTICS_TIMEOUT_MS= 200

[[env.production.kv_namespaces]]
binding = "REDIRECT_KV"
id = "23717fb69ec34910b4d0942167001260"
preview_id = "9097b5ddc08d4448b45fc416f107cb88"
